<script>
var desktop_personal_data = JSON.stringify({
	"name" : "",
	"alias" : "",
	"usb" : false,
	"status" : "",
	"jieru" : "终端",
	"ip_mac" : "12:03:FE:3B:75:34",
	"template" : "Windows7-32",
	"hardware" : { cpu : "2", mem : "2 GB", disk : "10 GB" },
	"host" : "..."
});
function vdiDesktopPersonalListController($scope, $rootElement, $element){
	$scope.rows = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].map(function(d, i){
		d = JSON.parse(desktop_personal_data);
		d.id = "$$_" + Math.random().toString(36).substr(2);
		d.name = "个人桌面-" + String.fromCharCode(20000 + Math.floor(Math.random() * 200));
		d.alias = ["张三", "李四", "王五", "Andy", "Jacky"][Math.floor((Math.random() * 5))] + "的桌面";
		d.status = "已运行 " + Math.ceil(Math.random() * 10) + "小时" + (Math.floor(Math.random() * 60)) + "分";
		d.host = "主机-" + String.fromCharCode(20000 + Math.floor(Math.random() * 200));
		d.template = ["WinXP", "Win7", "Win8", "OSX", "Linux32"][Math.floor((Math.random() * 5))];
		return d;
	});
	var _checkAll = $element.find("input[data-ng-model='rowCheckAll']")[0];
	var _cmdBtns = $element.find(".dt-toolbar .btn").addClass("disabled");
	var _cmdBatchBtns = _cmdBtns.filter(".isBatch");
	var _cmdSingleBtns = _cmdBtns.filter(".isSingle");
	var fn_some_check = function(_r){ return _r.checked; };
	var fn_change_buttons_state = function(){
		var _eles = $element.find("input[data-ng-model='row']");
		var _checkedLength = _eles.filter(":checked").length;
		if(_checkedLength){
			_cmdBtns.removeClass("disabled");
			if(_checkedLength > 1){
				_cmdSingleBtns.addClass("disabled");
			}
		}
		else{
			_cmdBtns.addClass("disabled");
		}
	};
	$scope.evCheckAll = function(checkAll){
		var _eles = $element.find("input[data-ng-model='row']");
		_eles.each(function(){
			this.checked = checkAll;
		});
		fn_change_buttons_state();
	};
	$scope.evCheck = function(check, id){
		_checkAll.checked = [].every.call($element.find("input[data-ng-model='row']"), function(_r){
			return _r.checked;
		});
		fn_change_buttons_state();
	};
}
</script>
<section id="widget-grid">
	<!-- row -->
	<div class="row">
		<!-- NEW WIDGET START -->
		<article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
			<!-- Widget ID (each widget will need unique ID)-->
			<div
				class="jarviswidget"
				id="wid-desktop-teach"
				data-ng-controller="vdiDesktopPersonalListController"
				data-widget-editbutton="true"
				data-widget-colorbutton="true"
				data-widget-editbutton="true"
				data-widget-togglebutton="true"
				data-widget-deletebutton="false"
				data-widget-fullscreenbutton="true"
				data-widget-custombutton="true"
				data-widget-collapsed="false"
				data-widget-sortable="true">
				<header>
					<span class="widget-icon"> <i class="fa fa-table"></i> </span>
					<h2>个人桌面</h2>
				</header>
				<!-- widget div-->
				<div>
					<!-- widget edit box -->
					<div class="jarviswidget-editbox">
						<!-- This area used as dropdown edit box -->
					</div>
					<!-- end widget edit box -->

					<!-- widget content -->
					<div class="widget-body no-padding">
						<div class="alert alert-info no-margin">
							<ul>
								<li>个人桌面可在任何一台终端登录。</li>
								<li>个人桌面与用户绑定，登录时需输入用户名和密码。</li>
								<li>个人桌面的开关机由用户或管理员手工控制。</li>
								<li>自然关机需要系统支持，没有安装的系统请使用强制关机。</li>
								<li>批量修改在桌面重启后生效。</li>
							</ul>
						</div>
						<div class="dataTables_wrapper form-inline no-footer">
							<div class="dt-toolbar">
								<div class="col-xs-12 col-sm-3"></div>
								<div class="col-sm-9 col-xs-10 hidden-xs">
									<a class="btn btn-info isBatch" href="javascript:">开机</a>
									<div class="btn-group">
										<button class="btn btn-info dropdown-toggle isBatch" data-toggle="dropdown">
											关机 <span class="caret"></span>
										</button>
										<ul class="dropdown-menu">
											<li><a class="isBatch" href="javascript:void(0);">强制关机</a></li>
											<li class="divider"></li>
											<li><a class="isBatch" href="javascript:void(0);">自然关机</a></li>
										</ul>
									</div>
									<a class="btn btn-info isBatch" href="javascript:">重启</a>
									<a class="btn btn-info isBatch" href="javascript:">暂停</a>
									<a class="btn btn-info isBatch" href="javascript:">恢复</a>
									<a class="btn btn-info isSingle" href="javascript:">查看桌面</a>
									<a class="btn btn-info isSingle" href="javascript:">动态迁移</a>
									<a class="btn btn-info isSingle" href="javascript:">桌面修改</a>
									<a class="btn btn-info isSingle" href="javascript:">存为模版</a>
									<a class="btn btn-info isSingle" href="javascript:">快照管理</a>
								</div>
							</div>
						</div>
						<div class="table-responsive">
							<table
								class="table table-bordered table-striped table-condensed table-hover smart-form has-tickbox"
								width="100%">
								<thead class="vdi_header">
									<tr>
										<th><label class="checkbox"><input type="checkbox" data-ng-model="rowCheckAll" data-ng-change="evCheckAll(rowCheckAll)" name="checkbox-inline"><i></i></label></th>
										<th>桌面</th>
										<th>运行状态</th>
										<th>接入方式</th>
										<th>IP/MAC</th>
										<th>用户	OS/模板</th>
										<th>虚拟硬件</th>
										<th>宿主机</th>
									</tr>
								</thead>
								<tbody class="vdi_body">
									<tr data-ng-repeat="item in rows">
										<td><label class="checkbox"><input data-ng-model="row" data-ng-change="evCheck(row, item.id)" type="checkbox" value="{{item.id}}" name="checkbox-inline"><i></i></label></td>
										<td>{{ item.name }}<br>[ {{ item.alias }} ]<br> {{ item.usb ? "支持USB" : "不支持USB" }}</td>
										<td>{{ item.status }}</td>
										<td>{{ item.jieru }}</td>
										<td>{{ item.ip_mac }}</td>
										<td>{{ item.template }}</td>
										<td>CPU = {{ item.hardware.cpu }} 个<br>内存 = {{ item.hardware.mem }}<br>硬盘 =  {{ item.hardware.disk }}</td>
										<td>{{ item.host }}</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
					<!-- end widget content -->
				</div>
				<!-- end widget div -->
			</div>
			<!-- end widget -->
		</article>
		<!-- WIDGET END -->
	</div>
	<!-- end row -->
</section>
<script>pageSetUp();</script>